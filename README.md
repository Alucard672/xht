# ğŸ“‘ é¡¹ç›®å¼€å‘è§„æ ¼ä¹¦ï¼šä¹¡è´§é€š (Xianghuotong)

> **ç‰ˆæœ¬ï¼š** 1.0.0 â†’ 1.1.0 (ä¸šåŠ¡è§„åˆ™æ›´æ–°)
> **ç±»å‹ï¼š** ä¹¡é•‡æ‰¹å‘ SaaS (UniApp + UniCloud)
> **æ ¸å¿ƒç†å¿µï¼š** ä¸€ç ä¸¤é¢ï¼ˆå•†å®¶é«˜æ•ˆç®¡è´¦ / å®¢æˆ·æç®€è®¢è´§ï¼‰

---

## 1. ä¸šåŠ¡è§’è‰²å®šä¹‰ (Business Roles)

> âš ï¸ **é‡è¦ï¼š** åœ¨æœ¬ç³»ç»Ÿä¸­ï¼ŒåŒä¸€ä¸ªè‡ªç„¶äººå¯èƒ½åŒæ—¶æ‹¥æœ‰"å•†å®¶"å’Œ"å®¢æˆ·"ä¸¤ç§èº«ä»½ï¼Œéœ€è¦æ˜ç¡®åŒºåˆ†ã€‚

### 1.1 è§’è‰²å®šä¹‰è¡¨

| è§’è‰²           | è‹±æ–‡     | è´¦å·ç±»å‹            | ä»˜è´¹æ¨¡å¼        | æ ¸å¿ƒæƒé™                                         |
| -------------- | -------- | ------------------- | --------------- | ------------------------------------------------ |
| **SaaSæœåŠ¡å•†** | Provider | ç³»ç»Ÿç®¡ç†å‘˜          | -               | å…¨å±€é…ç½®ã€å•†å®¶ç®¡ç†ã€æœ‰æ•ˆæœŸç­–ç•¥                   |
| **å•†å®¶**       | Merchant | å•†å®¶è´¦å· (uni-id)   | æœ‰æ•ˆæœŸåˆ¶ (ä»˜è´¹) | å•†å“ç®¡ç†ã€å®¢æˆ·ç®¡ç†ã€ä»£ä¸‹å•ã€è®¢å•å¤„ç†ã€åº—é“ºäºŒç»´ç  |
| **å®¢æˆ·**       | Customer | å®¢æˆ·è´¦å· (å¾®ä¿¡æˆæƒ) | å…è´¹            | æµè§ˆåº—é“ºã€ä¸‹å•ã€æŸ¥çœ‹è®¢å•å’Œæ¬ æ¬¾                   |

### 1.2 è§’è‰²è¾¹ç•Œè§„åˆ™

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SaaS æœåŠ¡å•† (Provider)                      â”‚
â”‚  â€¢ é…ç½®æœ‰æ•ˆæœŸç­–ç•¥                                                â”‚
â”‚  â€¢ åˆ›å»º/å®¡æ ¸å•†å®¶è´¦å·                                             â”‚
â”‚  â€¢ å…¨å±€æ•°æ®ç»Ÿè®¡                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       å•†å®¶ (Merchant)   â”‚     â”‚       å®¢æˆ· (Customer)    â”‚
â”‚  â€¢ å•†å®¶è´¦å·: uni-id     â”‚     â”‚  â€¢ å®¢æˆ·è´¦å·: å¾®ä¿¡OpenID  â”‚
â”‚  â€¢ ä»˜è´¹ä½¿ç”¨             â”‚     â”‚  â€¢ å…è´¹ä½¿ç”¨             â”‚
â”‚  â€¢ æœ‰æ•ˆæœŸç”±æœåŠ¡å•†æ§åˆ¶   â”‚     â”‚  â€¢ æ°¸ä¹…æœ‰æ•ˆ             â”‚
â”‚                        â”‚     â”‚                         â”‚
â”‚  â€¢ ç®¡ç†åå°è§†è§’         â”‚     â”‚  â€¢ åº—é“ºæµè§ˆè§†è§’         â”‚
â”‚  â€¢ å•†å“/å®¢æˆ·/è®¢å•ç®¡ç†   â”‚     â”‚  â€¢ æµè§ˆ/ä¸‹å•/ä»˜æ¬¾       â”‚
â”‚  â€¢ ä»£å®¢æˆ·ä¸‹å•           â”‚     â”‚                         â”‚
â”‚  â€¢ ç”Ÿæˆåº—é“ºäºŒç»´ç        â”‚     â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 å…³é”®ä¸šåŠ¡è§„åˆ™

#### è§„åˆ™ 1ï¼šå•†å®¶æœ‰æ•ˆæœŸç®¡ç†

```
å•†å®¶è´¦å·ç”Ÿå‘½å‘¨æœŸ:
â”œâ”€â”€ åˆ›å»ºæ–¹å¼: æœåŠ¡å•†åˆ›å»º OR å•†å®¶è‡ªä¸»æ³¨å†Œ
â”œâ”€â”€ æœ‰æ•ˆæœŸ: ç”±æœåŠ¡å•†ç»Ÿä¸€é…ç½® (å¦‚: 30å¤©/90å¤©/365å¤©)
â”œâ”€â”€ ä»˜è´¹: éœ€åœ¨æœ‰æ•ˆæœŸå†…ä»˜è´¹ç»­æœŸ
â”œâ”€â”€ è¿‡æœŸ: è´¦å·å†»ç»“ï¼Œåº—é“ºæ— æ³•è®¿é—®
â””â”€â”€ æ•°æ®ä¿ç•™: è¿‡æœŸåæ•°æ®ä¿ç•™Nå¤©(å¯é…ç½®)ï¼Œè¿‡æœŸåå½»åº•åˆ é™¤
```

#### è§„åˆ™ 2ï¼šå®¢æˆ·å…³è”æœºåˆ¶

```
å®¢æˆ·é¦–æ¬¡æ‰«ç è¿›å…¥å•†å®¶åº—é“º:
â”œâ”€â”€ æˆæƒå¾®ä¿¡ä¿¡æ¯ â†’ åˆ›å»ºå®¢æˆ·è´¦å· (uni-id-users)
â”œâ”€â”€ åˆ›å»ºå®¢æˆ·è®°å½• â†’ wh_customers è¡¨ (å•†å®¶è§†è§’)
â””â”€â”€ å»ºç«‹å…³è” â†’ å®¢æˆ·å¯çœ‹åˆ°è¯¥å•†å®¶åœ¨å•†å®¶åˆ—è¡¨ä¸­

å®¢æˆ·åç»­è®¿é—®:
â”œâ”€â”€ ä»"æˆ‘çš„å•†å®¶"åˆ—è¡¨è¿›å…¥
â””â”€â”€ æˆ–å†æ¬¡æ‰«ç è¿›å…¥
```

#### è§„åˆ™ 3ï¼šå•†å®¶è‡ªè´­è§„åˆ™

```
å•†å®¶åœ¨è‡ªå·±åº—é“ºä¸‹å•æ—¶:
â”œâ”€â”€ èº«ä»½åˆ‡æ¢: å•†å®¶ â†’ å®¢æˆ· (éšå¼åˆ‡æ¢)
â”œâ”€â”€ è®¢å•å½’å±: å®¢æˆ·è§†è§’çš„è®¢å•
â”œâ”€â”€ ç»Ÿè®¡åŒºåˆ†: è®¢å•æ ‡è®°ä¸º"å•†å®¶è‡ªè´­"
â””â”€â”€ è´¢åŠ¡æŠ¥è¡¨: å•†å®¶è‡ªè´­é‡‘é¢ä¸è®¡å…¥"é”€å”®æ€»é¢"

ä»£å®¢æˆ·ä¸‹å•:
â”œâ”€â”€ å•†å®¶ä¸»åŠ¨åˆ›å»ºè®¢å•
â”œâ”€â”€ è®¢å•æ ‡è®°ä¸º"ä»£ä¸‹å•"
â””â”€â”€ å…³è”åˆ°æŒ‡å®šå®¢æˆ·
```

---

## 2. å¤šç§Ÿæˆ·æ¨¡å‹ (Multi-Tenant Model)

### 2.1 ç§Ÿæˆ·éš”ç¦»æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      UniCloud æ•°æ®åº“                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ å…¨å±€è¡¨ (æ— ç§Ÿæˆ·)  â”‚      â”‚ ç§Ÿæˆ·è¡¨ (tenant) â”‚                   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”‚
â”‚  â”‚ uni-id-users    â”‚      â”‚ wh_tenants      â”‚                   â”‚
â”‚  â”‚   (æ‰€æœ‰ç”¨æˆ·)     â”‚      â”‚   (å•†å®¶ä¿¡æ¯)     â”‚                   â”‚
â”‚  â”‚                 â”‚      â”‚                 â”‚                   â”‚
â”‚  â”‚ wh_credit_apps  â”‚      â”‚ wh_goods        â”‚                   â”‚
â”‚  â”‚   (èµŠè´¦ç”³è¯·)    â”‚      â”‚   (å•†å“)        â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚                 â”‚                   â”‚
â”‚           â”‚               â”‚ wh_customers    â”‚                   â”‚
â”‚           â”‚               â”‚   (å®¢æˆ·è®°å½•)    â”‚                   â”‚
â”‚           â”‚               â”‚                 â”‚                   â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ wh_orders       â”‚                   â”‚
â”‚                   â”‚         (è®¢å•)          â”‚                   â”‚
â”‚                   â”‚                          â”‚                   â”‚
â”‚                   â–¼                          â–¼                   â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚          â”‚  å…³è”å…³ç³»        â”‚                              â”‚
â”‚          â”‚  uni-id â†” tenant â”‚                              â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ç§Ÿæˆ·éš”ç¦»è§„åˆ™

| æ•°æ®è¡¨         | éš”ç¦»æ–¹å¼ | ç´¢å¼•å­—æ®µ    | è¯´æ˜                 |
| -------------- | -------- | ----------- | -------------------- |
| `wh_tenants`   | å…¨å±€     | -           | å•†å®¶ä¿¡æ¯å…¨å±€å¯è§     |
| `wh_goods`     | ç§Ÿæˆ·éš”ç¦» | `tenant_id` | ä»…å•†å®¶å¯è§è‡ªå·±çš„å•†å“ |
| `wh_customers` | ç§Ÿæˆ·éš”ç¦» | `tenant_id` | å•†å®¶è§†è§’çš„å®¢æˆ·è®°å½•   |
| `wh_orders`    | ç§Ÿæˆ·éš”ç¦» | `tenant_id` | å•†å®¶è§†è§’çš„è®¢å•è®°å½•   |
| `uni-id-users` | å…¨å±€     | -           | æ‰€æœ‰ç”¨æˆ·å…±äº«         |
| `wh_debt_logs` | ç§Ÿæˆ·éš”ç¦» | `tenant_id` | èµŠè´¦è®°å½•             |

### 2.3 æ ¸å¿ƒæŸ¥è¯¢è§„åˆ™

```javascript
// âš ï¸ æ‰€æœ‰ç§Ÿæˆ·æ•°æ®æŸ¥è¯¢å¿…é¡»åŒ…å« tenant_id è¿‡æ»¤

// âœ… æ­£ç¡®ç¤ºä¾‹
const tenant_id = uni.getStorageSync('tenant_id')
db.collection('wh_goods').where({ tenant_id: tenant_id }).get()

// âŒ é”™è¯¯ç¤ºä¾‹ (ç¦æ­¢)
db.collection('wh_goods').get()
```

---

## 3. æŠ€æœ¯æ¶æ„ (Tech Stack)

| æ¨¡å—          | é€‰å‹                       | è¯´æ˜                                        |
| :------------ | :------------------------- | :------------------------------------------ |
| **å‰ç«¯æ¡†æ¶**  | **UniApp (Vue3)**          | ä½¿ç”¨ Composition API (`<script setup>`)     |
| **UI ç»„ä»¶åº“** | **uView-Plus**             | å¿…é¡»å…¼å®¹ Vue3ï¼Œé€‚åˆç§»åŠ¨ç«¯å¿«é€Ÿå¼€å‘           |
| **åç«¯æœåŠ¡**  | **UniCloud (é˜¿é‡Œäº‘ç‰ˆ)**    | Serverless æ¶æ„ï¼Œæ— è¿ç»´æˆæœ¬                 |
| **æ•°æ®åº“**    | **UniCloud JSON DB**       | NoSQL æ–‡æ¡£å‹æ•°æ®åº“                          |
| **æŸ¥è¯¢è¯­è¨€**  | **JQL**                    | å‰ç«¯ç›´æ¥é€šè¿‡ `clientDB` å®‰å…¨æŸ¥åº“            |
| **ç”¨æˆ·ä½“ç³»**  | **uni-id**                 | `uni-id-pages` + `uni-id-co` (å¾®ä¿¡ä¸€é”®ç™»å½•) |
| **å¼€å‘ç¯å¢ƒ**  | **HBuilderX** + **Cursor** | HBuilderX è´Ÿè´£ç¼–è¯‘éƒ¨ç½²ï¼ŒCursor è´Ÿè´£å†™ä»£ç    |

---

## 4. æ ¸å¿ƒæ•°æ®åº“è®¾è®¡ (Database Schema)

| æ¨¡å—          | é€‰å‹                       | è¯´æ˜                                        |
| :------------ | :------------------------- | :------------------------------------------ |
| **å‰ç«¯æ¡†æ¶**  | **UniApp (Vue3)**          | ä½¿ç”¨ Composition API (`<script setup>`)     |
| **UI ç»„ä»¶åº“** | **uView-Plus**             | å¿…é¡»å…¼å®¹ Vue3ï¼Œé€‚åˆç§»åŠ¨ç«¯å¿«é€Ÿå¼€å‘           |
| **åç«¯æœåŠ¡**  | **UniCloud (é˜¿é‡Œäº‘ç‰ˆ)**    | Serverless æ¶æ„ï¼Œæ— è¿ç»´æˆæœ¬                 |
| **æ•°æ®åº“**    | **UniCloud JSON DB**       | NoSQL æ–‡æ¡£å‹æ•°æ®åº“                          |
| **æŸ¥è¯¢è¯­è¨€**  | **JQL**                    | å‰ç«¯ç›´æ¥é€šè¿‡ `clientDB` å®‰å…¨æŸ¥åº“            |
| **ç”¨æˆ·ä½“ç³»**  | **uni-id**                 | `uni-id-pages` + `uni-id-co` (å¾®ä¿¡ä¸€é”®ç™»å½•) |
| **å¼€å‘ç¯å¢ƒ**  | **HBuilderX** + **Cursor** | HBuilderX è´Ÿè´£ç¼–è¯‘éƒ¨ç½²ï¼ŒCursor è´Ÿè´£å†™ä»£ç    |

---

## 3. æ ¸å¿ƒæ•°æ®åº“è®¾è®¡ (Database Schema)

> âš ï¸ **SaaS æ ¸å¿ƒè§„åˆ™ï¼š** æ‰€æœ‰ä¸šåŠ¡è¡¨å¿…é¡»åŒ…å« `tenant_id` (å•†å®¶/ç§Ÿæˆ·ID) å­—æ®µï¼Œå¹¶å»ºç«‹ç´¢å¼•ã€‚

### 3.1 ç§Ÿæˆ·è¡¨ (`wh_tenants`)

| å­—æ®µ           | ç±»å‹      | æè¿°                                           |
| :------------- | :-------- | :--------------------------------------------- |
| `_id`          | String    | ç§Ÿæˆ·å”¯ä¸€ID                                     |
| `name`         | String    | åº—é“ºåç§° (å¦‚ï¼šè€ç‹æ‰¹å‘éƒ¨)                      |
| `owner_uid`    | String    | å…³è”çš„è€æ¿ `uni-id`                            |
| `owner_mobile` | String    | è€æ¿æ‰‹æœºå·                                     |
| `status`       | Int       | **çŠ¶æ€**: 0-å¾…å®¡æ ¸, 1-æ­£å¸¸, 2-å·²å†»ç»“, 3-å·²è¿‡æœŸ |
| `expired_at`   | Timestamp | **ä¼šå‘˜åˆ°æœŸæ—¶é—´**                               |
| `settings`     | Object    | åº—é“ºé…ç½® (æ˜¯å¦å…è®¸èµŠè´¦ã€æœ€ä½èµ·é€ç­‰)            |
| `created_at`   | Timestamp | åˆ›å»ºæ—¶é—´                                       |
| `updated_at`   | Timestamp | æ›´æ–°æ—¶é—´                                       |

### 3.1.1 å•†å®¶æœ‰æ•ˆæœŸè§„åˆ™

```
çŠ¶æ€æµè½¬:
å¾…å®¡æ ¸(0) â†’ æ­£å¸¸(1) â†’ å·²å†»ç»“(2) / å·²è¿‡æœŸ(3)
     â”‚            â”‚
     â”‚            â””â”€â”€ ä»˜è´¹ç»­æœŸ â†’ é‡ç½®è¿‡æœŸæ—¶é—´
     â”‚
     â””â”€â”€ æœåŠ¡å•†å®¡æ ¸ â†’ è®¾ç½®æœ‰æ•ˆæœŸ
```

### 3.2 å•†å“è¡¨ (`wh_goods`) - **æ ¸å¿ƒéš¾ç‚¹**

| å­—æ®µ            | ç±»å‹    | æè¿°                                            |
| :-------------- | :------ | :---------------------------------------------- |
| `tenant_id`     | String  | **[ç´¢å¼•]** æ‰€å±å•†å®¶                             |
| `name`          | String  | å•†å“åç§°                                        |
| `category_id`   | String  | åˆ†ç±»ID                                          |
| `img_url`       | String  | å›¾ç‰‡åœ°å€                                        |
| `is_multi_unit` | Boolean | æ˜¯å¦å¼€å¯å¤šå•ä½ (ç®±/ç“¶)                          |
| `unit_big`      | Object  | `{ name: "ç®±", price: 2400 }` (ä»·æ ¼å•ä½: åˆ†)    |
| `unit_small`    | Object  | `{ name: "ç“¶", price: 100 }`                    |
| `rate`          | Int     | æ¢ç®—ç‡ (å¦‚ 24ï¼Œå³ 1ç®±=24ç“¶)                     |
| `stock`         | Int     | **æ€»åº“å­˜ (ä»¥æœ€å°å•ä½å­˜å‚¨)**ã€‚å¦‚å­˜ 240 ä»£è¡¨ 10ç®± |
| `is_on_sale`    | Boolean | ä¸Šæ¶çŠ¶æ€                                        |

### 3.3 å®¢æˆ·/è´¦æœ¬è¡¨ (`wh_customers`)

| å­—æ®µ              | ç±»å‹      | æè¿°                                       |
| :---------------- | :-------- | :----------------------------------------- |
| `tenant_id`       | String    | **[ç´¢å¼•]** æ‰€å±å•†å®¶                        |
| `user_uid`        | String    | å…³è”çš„ç”¨æˆ· UID (uni-id-users)              |
| `alias`           | String    | å•†å®¶å¤‡æ³¨å (å¦‚ï¼šæ‘å£æå¤§çˆ·)                |
| `phone`           | String    | æ‰‹æœºå·                                     |
| `total_debt`      | Int       | **å½“å‰æ¬ æ¬¾æ€»é¢** (å•ä½: åˆ†)ã€‚æ­£æ•°=æ¬ å•†å®¶é’± |
| `credit_limit`    | Int       | èµŠè´¦é¢åº¦ (åˆ†)ï¼Œé»˜è®¤5000                    |
| `last_trade_time` | Timestamp | æœ€åäº¤æ˜“æ—¶é—´                               |
| `created_at`      | Timestamp | é¦–æ¬¡å…³è”æ—¶é—´                               |

### 3.3.1 å®¢æˆ·å…³è”è¯´æ˜

```
åŒä¸€ä¸ªè‡ªç„¶äººå¯èƒ½å‡ºç°åœ¨å¤šä¸ªå•†å®¶çš„å®¢æˆ·åˆ—è¡¨ä¸­:
â”œâ”€â”€ å®¢æˆ·Aåœ¨å•†å®¶Bçš„è®°å½•: wh_customers (tenant_id=B, user_uid=A)
â”œâ”€â”€ å®¢æˆ·Aåœ¨å•†å®¶Cçš„è®°å½•: wh_customers (tenant_id=C, user_uid=A)
â””â”€â”€ å®¢æˆ·Açš„å…¨å±€èº«ä»½: uni-id-users (_id=A)
```

### 3.4 è®¢å•è¡¨ (`wh_orders`)

| å­—æ®µ                | ç±»å‹      | æè¿°                                                                           |
| :------------------ | :-------- | :----------------------------------------------------------------------------- |
| `tenant_id`         | String    | **[ç´¢å¼•]**                                                                     |
| `customer_id`       | String    | ä¸‹å•å®¢æˆ·ID                                                                     |
| `order_no`          | String    | è®¢å•å· (æ—¶é—´æˆ³+éšæœºæ•°)                                                         |
| `status`            | Int       | 0:å¾…æ¥å•, 1:å¾…å‘è´§, 2:å·²å®Œæˆ, -1:å·²å–æ¶ˆ                                        |
| `payment_method`    | String    | `credit` (èµŠè´¦), `wechat` (åœ¨çº¿æ”¯ä»˜)                                           |
| `items`             | Array     | å•†å“å¿«ç…§æ•°ç»„                                                                   |
| `total_fee`         | Int       | è®¢å•æ€»é‡‘é¢ (åˆ†)                                                                |
| `order_type`        | String    | **è®¢å•ç±»å‹**: `customer`(å®¢æˆ·ä¸‹å•), `merchant_self`(å•†å®¶è‡ªè´­), `agent`(ä»£ä¸‹å•) |
| `created_by`        | String    | åˆ›å»ºäºº UID: `customer`æˆ–`merchant`                                             |
| `agent_merchant_id` | String    | **ä»£ä¸‹å•å•†å®¶ID** (ä»…ä»£ä¸‹å•æ—¶å¡«)                                                |
| `created_at`        | Timestamp | åˆ›å»ºæ—¶é—´                                                                       |

### 3.4.1 è®¢å•ç±»å‹è¯´æ˜

```
order_type å­—æ®µè§„åˆ™:
â”œâ”€â”€ customer (å®¢æˆ·æ‰«ç ä¸‹å•)
â”‚   â””â”€â”€ created_by: customer
â”‚   â””â”€â”€ ç»Ÿè®¡: è®¡å…¥å•†å®¶é”€å”®é¢
â”‚
â”œâ”€â”€ merchant_self (å•†å®¶è‡ªè´­)
â”‚   â””â”€â”€ created_by: merchant
â”‚   â””â”€â”€ ç»Ÿè®¡: ä¸è®¡å…¥é”€å”®æ€»é¢ï¼Œæ ‡è®°ä¸º"è‡ªè´­"
â”‚
â””â”€â”€ agent (ä»£ä¸‹å•)
    â””â”€â”€ created_by: merchant
    â””â”€â”€ agent_merchant_id: å•†å®¶ID
    â””â”€â”€ ç»Ÿè®¡: è®¡å…¥é”€å”®é¢ï¼Œå…³è”åˆ°å®¢æˆ·
```

### 3.5 èµŠè´¦è®°å½•è¡¨ (`wh_debt_logs`)

| å­—æ®µ          | ç±»å‹      | æè¿°                              |
| :------------ | :-------- | :-------------------------------- |
| `tenant_id`   | String    | **[ç´¢å¼•]** æ‰€å±å•†å®¶               |
| `customer_id` | String    | å®¢æˆ·ID                            |
| `type`        | String    | `borrow`(èµŠè´¦), `repay`(è¿˜æ¬¾)     |
| `amount`      | Int       | **é‡‘é¢ (åˆ†)**ã€‚èµŠè´¦ä¸ºæ­£ï¼Œè¿˜æ¬¾ä¸ºè´Ÿ |
| `source`      | String    | `order`(è®¢å•), `manual`(æ‰‹åŠ¨)     |
| `order_id`    | String    | å…³è”è®¢å•ID (è®¢å•ç±»å‹å¯ä¸ºç©º)       |
| `remark`      | String    | å¤‡æ³¨                              |
| `created_at`  | Timestamp | åˆ›å»ºæ—¶é—´                          |

### 3.6 å•†å®¶åº—é“ºäºŒç»´ç è¡¨ (`wh_shop_codes`)

| å­—æ®µ         | ç±»å‹      | æè¿°                                              |
| :----------- | :-------- | :------------------------------------------------ |
| `tenant_id`  | String    | **[ç´¢å¼•]** æ‰€å±å•†å®¶                               |
| `code`       | String    | åº—é“ºç  (Base64ç¼–ç çš„JSON: {tenant_id, timestamp}) |
| `qr_url`     | String    | äºŒç»´ç å›¾ç‰‡åœ°å€                                    |
| `is_active`  | Boolean   | æ˜¯å¦æœ‰æ•ˆ                                          |
| `scan_count` | Int       | æ‰«ç æ¬¡æ•°                                          |
| `created_at` | Timestamp | åˆ›å»ºæ—¶é—´                                          |

### 3.7 å®¢æˆ·å…³è”å•†å®¶è¡¨ (`wh_customer_tenants`)

| å­—æ®µ            | ç±»å‹      | æè¿°               |
| :-------------- | :-------- | :----------------- |
| `user_uid`      | String    | **[ç´¢å¼•]** å®¢æˆ·UID |
| `tenant_id`     | String    | **[ç´¢å¼•]** å•†å®¶ID  |
| `first_scan_at` | Timestamp | é¦–æ¬¡æ‰«ç æ—¶é—´       |
| `last_visit_at` | Timestamp | æœ€è¿‘è®¿é—®æ—¶é—´       |
| `total_orders`  | Int       | ç´¯è®¡è®¢å•æ•°         |
| `total_spent`   | Int       | ç´¯è®¡æ¶ˆè´¹ (åˆ†)      |
| `created_at`    | Timestamp | å…³è”åˆ›å»ºæ—¶é—´       |

---

## 5. åŠŸèƒ½æ¨¡å—è¯¦æƒ… (Functional Specs)

### ğŸ“± å®¢æˆ·ç«¯ (å°å–éƒ¨è€æ¿)

1.  **æ‰«ç è¿›åº—ï¼š**
    - å¿…é¡»é€šè¿‡æ‰«å•†å®¶çš„â€œåº—é“ºç â€è¿›å…¥ï¼Œè‡ªåŠ¨ç»‘å®š `tenant_id`ã€‚
2.  **å•†å“åˆ—è¡¨ï¼š**
    - å·¦ä¾§åˆ†ç±»å¯¼èˆªï¼Œå³ä¾§å•†å“æµã€‚
    - **å¤šå•ä½å±•ç¤ºï¼š** æ˜¾ç¤º "ï¿¥24/ç®±"ï¼Œç‚¹å‡» `+` å·å¼¹å‡ºé€‰è§„æ ¼é¢æ¿ã€‚
3.  **è´­ç‰©è½¦ (Cart)ï¼š**
    - æ”¯æŒå¤æ‚æ•°é‡ç¼–è¾‘ï¼š`[ 2 ] ç®± [ 5 ] ç“¶`ã€‚
    - å®æ—¶è®¡ç®—æ€»ä»·ã€‚
4.  **ä¸‹å•ç»“ç®—ï¼š**
    - ç¡®è®¤æ”¶è´§åœ°å€ï¼ˆæ”¯æŒç®€å•çš„æ–‡æœ¬è¾“å…¥æˆ–é€‰æ‹©ï¼‰ã€‚
    - é€‰æ‹©æ”¯ä»˜æ–¹å¼ï¼ˆé»˜è®¤å‹¾é€‰â€œè®°è´¦â€ï¼‰ã€‚
5.  **æˆ‘çš„èµ„äº§ï¼š**
    - **çº¢è‰²å¤§å­—**æ˜¾ç¤ºå½“å‰æ¬ æ¬¾ã€‚
    - æŸ¥çœ‹å†å²é‡‡è´­è®¢å•ã€‚

### ğŸ’» å•†å®¶ç«¯ (æ‰¹å‘éƒ¨è€æ¿)

1.  **å·¥ä½œå°ï¼š**
    - ä»Šæ—¥æ•°æ®ï¼šè®¢å•æ•°ã€é”€å”®é¢ã€‚
    - å¸¸ç”¨åŠŸèƒ½å…¥å£ï¼šå¼€å•ã€å•†å“ã€å®¢æˆ·ã€åº—é“ºç ã€‚
2.  **å•†å“ç®¡ç†ï¼š**
    - æ–°å¢å•†å“ï¼šæ”¯æŒä¸Šä¼ å›¾ç‰‡ï¼ˆè‡ªåŠ¨å‹ç¼©ï¼‰ã€è®¾ç½®å¤šå•ä½æ¢ç®—ç‡ã€‚
    - åº“å­˜ç®¡ç†ï¼šæ”¯æŒç›´æ¥ä¿®æ”¹åº“å­˜æ•°å­—ã€‚
3.  **è®¢å•å¤„ç†ï¼š**
    - æ¥å• -> å‘è´§ -> ç¡®è®¤é€è¾¾ã€‚
    - **åˆ†äº«å•æ®ï¼š** ç”Ÿæˆç±»ä¼¼å°ç¥¨çš„é•¿å›¾ç‰‡ï¼ˆåŒ…å«å•†å“æ˜ç»†ã€æ€»ä»·ã€æ”¶æ¬¾ç ï¼‰ï¼Œæ–¹ä¾¿å‘å¾®ä¿¡ã€‚
4.  **èµŠè´¦ç®¡ç† (æ ¸å¿ƒ)ï¼š**
    - å®¢æˆ·åˆ—è¡¨æŒ‰æ¬ æ¬¾é‡‘é¢æ’åºã€‚
    - **è®°ä¸€ç¬”ï¼š** æ‰‹åŠ¨å½•å…¥ä¸€ç¬”æ¬ æ¬¾ï¼ˆéç³»ç»Ÿè®¢å•ï¼‰ã€‚
    - **è¿˜ä¸€ç¬”ï¼š** å½•å…¥è¿˜æ¬¾é‡‘é¢ï¼Œè‡ªåŠ¨æ‰£å‡æ¬ æ¬¾ã€‚

---

## 5. AI å¼€å‘æŒ‡ä»¤è§„åˆ™ (Rules for Cursor)

**è¯·å°†ä»¥ä¸‹è‹±æ–‡å†…å®¹å¤åˆ¶åˆ° Cursor çš„ `.cursorrules` æ–‡ä»¶ä¸­ï¼Œä»¥ç¡®ä¿ AI ç†è§£ SaaS é€»è¾‘ï¼š**

```markdown
# Role Definition

You are an expert full-stack developer specialized in UniApp (Vue3 + Vite) and UniCloud (Aliyun). You are building "Xianghuotong", a SaaS for wholesale merchants.

# Technical Constraints

- **Framework:** Vue 3 with `<script setup>`.
- **UI Library:** `uView-Plus`. Use standard components (u-button, u-cell, u-input).
- **Database:** UniCloud JSON DB.
- **Language:** JavaScript (ES6+).

# Critical Business Rules (SaaS Logic)

1. **Tenant Isolation:**
   - Every database query (JQL) MUST strictly filter by `tenant_id`.
   - Example: `db.collection('wh_goods').where('tenant_id == "..."').get()`
   - Never query data without a tenant context.

2. **Price & Stock Logic:**
   - **Currency:** All prices are stored as **Integers (Unit: Fen/Cent)**. Divide by 100 only for display.
   - **Stock:** Stock is always stored in the **Smallest Unit**.
   - **Conversion:**
     - Display Stock = `Math.floor(total_stock / rate)` (Big Unit) + `total_stock % rate` (Small Unit).
     - Total Price = `(count_big * rate + count_small) * price_small`.

3. **Offline-Friendly UI:**
   - Buttons must be large (min-height: 44px).
   - Text colors must have high contrast.
   - Use simple language suitable for rural users.

# Coding Workflow

1. When asked to implement a feature, FIRST check if the `database schema` (\*.schema.json) supports it. If not, generate the schema code first.
2. THEN generate the Cloud Object (Backend logic) if complex calculation is needed.
3. FINALLY generate the Vue Page code.
```
