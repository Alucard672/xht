# 乡货通 MVP 测试计划

## 📋 测试概述

**测试目标**: 验证 MVP 简化后的功能完整性
**测试环境**: 微信小程序 + H5
**测试日期**: 2025-01-28

---

## 🧪 测试清单

### 🔐 前置条件

- [ ] 已部署最新的 Cloud Functions
- [ ] 前端代码已编译到最新版本
- [ ] 测试账号准备：
  - 商户账号: 13003629527
  - 客户账号: 需要微信登录

---

## 👨‍💼 商户端测试

### 1️⃣ 工作台 (Dashboard)

**页面**: `/pages/merchant/dashboard`

**测试项**:

- [ ] ✅ **无库存预警区块** - 确认已删除
- [ ] ✅ **统计数据正常显示**
  - 今日订单数
  - 今日销售额
  - 待处理订单数
- [ ] ✅ **快捷操作卡片可点击**
  - 快速开单 → 跳转到开单页面
  - 商品管理 → 跳转到商品列表
  - 客户账本 → 跳转到客户列表
  - 店铺码 → 跳转到新的店铺设置页面（tab=1）
- [ ] ✅ **待处理订单列表显示**
  - 订单卡片信息完整
  - 点击无详情页（已删除）
- [ ] ✅ **过期/即将过期横幅显示正常**
  - 过期红色横幅
  - 即将过期黄色横幅
  - 续费按钮可点击

**预期结果**: 所有功能正常，无库存预警相关内容

---

### 2️⃣ 商品管理

**页面**: `/pages/merchant/goods/list`

**测试项**:

- [ ] ✅ **无库存预警条** - 确认已删除
- [ ] ✅ **商品列表正常显示**
  - 商品卡片无库存显示
  - 商品图片、名称、价格正常
  - 上架/下架状态正确
- [ ] ✅ **搜索功能正常**
  - 搜索商品名称
  - 清空搜索
- [ ] ✅ **添加商品按钮**
  - 点击跳转到编辑页面

**页面**: `/pages/merchant/goods/edit`

**测试项**:

- [ ] ✅ **无库存输入字段** - 确认已删除
- [ ] ✅ **表单字段完整**
  - 商品名称（必填）
  - 所属分类（必填）
  - 商品图片
  - 多单位设置（开关）
  - 大单位名称、换算率、大单位价格
  - 小单位名称、小单位价格（必填）
  - 是否上架销售
- [ ] ✅ **保存功能正常**
  - 新建商品保存成功
  - 编辑商品保存成功
  - 表单验证正常

**预期结果**: 商品管理流程完整，无库存相关字段

---

### 3️⃣ 订单管理

**页面**: `/pages/merchant/order/list`

**测试项**:

- [ ] ✅ **订单列表显示正常**
  - 标签页切换（全部/待接单/配送中/已完成）
  - 订单卡片信息完整
    - 订单号
    - 客户信息
    - 商品明细
    - 支付方式（赊账/现结）
    - 总金额
- [ ] ✅ **内联操作功能**
  - 待接单订单 → "确认接单" 按钮
  - 配送中订单 → "确认送达" 按钮
  - 操作后状态更新正确
- [ ] ✅ **无订单详情页** - 确认点击卡片不跳转
- [ ] ✅ **开单入口** - 底部或顶部"快速开单"按钮

**预期结果**: 订单管理功能完整，所有操作在列表页完成

---

### 4️⃣ 客户账本

**页面**: `/pages/merchant/customer/list`

**测试项**:

- [ ] ✅ **客户列表显示正常**
  - 客户名称、电话
  - 当前欠款（红色显示）
  - 欠款为0显示为黑色
- [ ] ✅ **搜索功能**
  - 按姓名搜索
  - 按电话搜索
- [ ] ✅ **点击客户卡片**
  - 跳转到客户详情
- [ ] ✅ **添加客户按钮**正常

**页面**: `/pages/merchant/customer/detail`

**测试项**:

- [ ] ✅ **客户详情显示**
  - 基本信息
  - 当前欠款金额
  - 欠款历史记录
  - 交易记录
- [ ] ✅ **录入还款功能**
  - 输入还款金额
  - 提交成功
  - 欠款金额更新

**预期结果**: 客户管理和欠款追踪功能完整

---

### 5️⃣ 店铺设置（新合并页面）

**页面**: `/pages/merchant/store`

**测试项**:

- [ ] ✅ **Tab 切换正常**
  - 店铺信息 Tab
  - 二维码 Tab
- [ ] ✅ **店铺信息 Tab**
  - 订阅信息显示（到期时间、剩余天数）
  - 店铺名称可编辑
  - 联系电话可编辑
  - 保存按钮功能正常
  - 过期/即将过期提示和续费按钮
- [ ] ✅ **二维码 Tab**
  - 店铺信息显示（名称、扫码次数）
  - 二维码图片显示
  - 点击二维码预览大图
  - 保存图片按钮
  - 分享给客户按钮
  - 停用二维码按钮（带确认）

**预期结果**: 两个 Tab 功能完整，原有功能保留

---

### 6️⃣ 开单流程

**页面**: `/pages/merchant/order/create`

**测试项**:

- [ ] ✅ **选择客户**
  - 点击客户选择器
  - 跳转到客户列表
  - 选择客户后返回
  - 客户信息正确显示
- [ ] ✅ **添加商品**
  - 点击添加商品
  - 跳转到商品列表
  - 选择商品和数量
  - 返回开单页面
  - 商品明细正确显示
- [ ] ✅ **多单位商品**
  - 选择大单位数量（箱）
  - 选择小单位数量（瓶）
  - 总价计算正确
- [ ] ✅ **支付方式**
  - 赊账选项
  - 现结选项
- [ ] ✅ **提交订单**
  - 表单验证
  - 提交成功提示
  - 跳转到订单列表

**预期结果**: 开单流程完整，多单位计算正确

---

## 👤 客户端测试

### 7️⃣ 扫码进店

**页面**: `/pages/client/scan`

**测试项**:

- [ ] ✅ **无手动输入框** - 确认已删除
- [ ] ✅ **扫码功能**
  - 点击扫码图标
  - 扫描商家二维码
  - 解析成功进入店铺
- [ ] ✅ **错误处理**
  - 扫描无效二维码 → 显示"无效的店铺码，请联系商家"
  - 扫描已冻结店铺 → 显示"店铺已冻结，请联系商家"
  - 扫描已过期店铺 → 显示"店铺已过期，请联系商家续费"
  - 扫描审核中店铺 → 显示"店铺审核中，暂未开业"
- [ ] ✅ **登录检查**
  - 未登录用户扫码 → 提示先登录
- [ ] ✅ **成功进店**
  - tenant_id 正确保存
  - 跳转到店铺页面

**预期结果**: 扫码进店流程流畅，错误提示友好

---

### 8️⃣ 店铺浏览

**页面**: `/pages/client/shop`

**测试项**:

- [ ] ✅ **店铺头部显示**
  - 店铺名称
  - Logo（如果有）
- [ ] ✅ **搜索功能**
  - 点击搜索框
  - 输入关键词
  - 无搜索面板（已删除）
  - 无公告栏（已删除）
- [ ] ✅ **分类浏览**
  - 左侧分类列表
  - 点击分类切换商品
  - "全部商品"分类
- [ ] ✅ **商品列表**
  - 商品卡片显示
    - 图片
    - 名称
    - 双单位价格（大/小单位）
    - 添加按钮
- [ ] ✅ **添加到购物车**
  - 点击 [+] 按钮
  - 弹出数量选择器
  - 选择大/小单位数量
  - 实时计算小计
  - 确认添加
- [ ] ✅ **购物车**
  - 底部购物车栏显示
  - 显示商品件数
  - 显示总价
  - 点击购物车图标打开抽屉
  - 购物车内商品明细
  - 修改数量
  - 删除商品
  - 去结算按钮

**预期结果**: 浏览商品和加购流程流畅

---

### 9️⃣ 下单结算

**页面**: `/pages/client/checkout`

**测试项**:

- [ ] ✅ **订单明细显示**
  - 商品列表
  - 数量、单价
  - 总价计算
- [ ] ✅ **无地址选择** - 确认已删除
- [ ] ✅ **支付方式固定显示**
  - 显示"支付方式：货到付款（商家联系您）"
  - 无支付方式选择（已删除）
- [ ] ✅ **订单备注**
  - 输入框可用
- [ ] ✅ **提交订单**
  - 按钮可点击
  - 提交成功提示
  - 跳转回店铺页面

**预期结果**: 结算流程简化，固定赊账支付

---

### 🔟 订单历史

**页面**: `/pages/client/orders`

**测试项**:

- [ ] ✅ **订单列表显示**
  - 订单卡片默认折叠
  - 显示订单号、日期、状态
  - 显示支付方式、总金额
- [ ] ✅ **展开订单详情**
  - 点击订单卡片展开
  - 显示商品明细列表
  - 显示"再次下单"按钮
  - 再次点击折叠
- [ ] ✅ **展开图标指示**
  - 折叠状态显示向下箭头
  - 展开状态显示向上箭头
- [ ] ✅ **再次下单按钮**
  - 点击显示"功能开发中"提示（MVP）
  - 或实现批量加购到购物车

**预期结果**: 订单历史可展开查看详情

---

## 🔄 跨端流程测试

### 流程1: 客户下单 → 商户接单

1. **[客户端]** 扫码进店 → ✅ 成功进入店铺
2. **[客户端]** 浏览商品，添加到购物车 → ✅ 商品加入购物车
3. **[客户端]** 提交订单 → ✅ 订单创建成功
4. **[商户端]** 工作台显示待处理订单 → ✅ 订单出现在列表
5. **[商户端]** 订单列表确认接单 → ✅ 状态更新为"配送中"
6. **[客户端]** 查看订单历史 → ✅ 订单状态更新

**预期结果**: 完整下单流程无障碍

---

### 流程2: 商户代客下单

1. **[商户端]** 快速开单 → ✅ 进入开单页面
2. **[商户端]** 选择客户 → ✅ 客户选择正常
3. **[商户端]** 添加商品（多单位） → ✅ 商品明细正确
4. **[商户端]** 选择支付方式（赊账/现结） → ✅ 选择正常
5. **[商户端]** 提交订单 → ✅ 订单创建成功
6. **[商户端]** 查看客户账本 → ✅ 欠款金额更新（如果赊账）

**预期结果**: 代客下单流程完整

---

### 流程3: 客户还款

1. **[商户端]** 客户账本 → ✅ 进入客户列表
2. **[商户端]** 选择有欠款的客户 → ✅ 进入客户详情
3. **[商户端]** 查看当前欠款 → ✅ 欠款金额显示
4. **[商户端]** 录入还款 → ✅ 还款表单正常
5. **[商户端]** 输入还款金额，提交 → ✅ 还款成功
6. **[商户端]** 确认欠款减少 → ✅ 欠款金额更新

**预期结果**: 还款流程正常

---

## 🔒 多租户隔离验证

**关键测试**: 确保不同商户数据完全隔离

- [ ] ✅ **商户A只能看到自己的商品**
  - 登录商户A账号
  - 商品列表只显示商户A的商品
- [ ] ✅ **商户A只能看到自己的订单**
  - 订单列表只包含商户A的订单
- [ ] ✅ **商户A只能看到自己的客户**
  - 客户列表只包含商户A的客户
- [ ] ✅ **客户端扫码只能进入对应店铺**
  - 扫商户A的二维码 → 只能看到商户A的商品
  - 订单归属到商户A
- [ ] ✅ **数据不泄露**
  - 商户A无法查询到商户B的任何数据

**测试方法**: 准备两个商户账号，交叉验证数据隔离

---

## 📱 兼容性测试

### 微信小程序

- [ ] ✅ 所有页面在微信小程序中正常显示
- [ ] ✅ 所有交互功能正常
- [ ] ✅ 路由跳转无错误
- [ ] ✅ 云对象调用成功
- [ ] ✅ 图片上传/显示正常

### H5 浏览器

- [ ] ✅ 所有页面在浏览器中正常显示
- [ ] ✅ 所有交互功能正常
- [ ] ✅ 响应式布局适配

---

## 🐛 已知问题和限制

### MVP 简化带来的功能变更

1. **❌ 不再支持的功能**
   - 库存管理（UI 移除，数据库字段保留）
   - 库存预警
   - 通知系统
   - 订单详情页（改为列表内联操作）
   - 客户端"我的商家"页面
   - 客户端"我的资产"页面
   - 地址选择（批发业务不需要）
   - 在线支付（固定赊账）

2. **⚠️ 待后续实现**
   - 订单历史"再次下单"功能
   - 购物车批量编辑
   - 高级搜索筛选

---

## ✅ 验收标准

### 功能完整性

- [ ] 所有核心流程可走通
- [ ] 无功能回归
- [ ] 多租户隔离正确
- [ ] 错误处理友好

### 性能

- [ ] 页面加载 < 2秒
- [ ] 列表滚动流畅
- [ ] 无卡顿现象

### 兼容性

- [ ] 微信小程序功能正常
- [ ] H5 浏览器功能正常

---

## 📝 测试结果记录

**测试人**: ****\_\_\_****
**测试日期**: ****\_\_\_****
**测试环境**: 微信小程序 / H5
**测试结果**:

| 测试项       | 结果          | 备注 |
| ------------ | ------------- | ---- |
| 商户端工作台 | ☐ 通过 ☐ 失败 |      |
| 商品管理     | ☐ 通过 ☐ 失败 |      |
| 订单管理     | ☐ 通过 ☐ 失败 |      |
| 客户账本     | ☐ 通过 ☐ 失败 |      |
| 店铺设置     | ☐ 通过 ☐ 失败 |      |
| 开单流程     | ☐ 通过 ☐ 失败 |      |
| 扫码进店     | ☐ 通过 ☐ 失败 |      |
| 店铺浏览     | ☐ 通过 ☐ 失败 |      |
| 下单结算     | ☐ 通过 ☐ 失败 |      |
| 订单历史     | ☐ 通过 ☐ 失败 |      |
| 跨端流程     | ☐ 通过 ☐ 失败 |      |
| 多租户隔离   | ☐ 通过 ☐ 失败 |      |

**整体评价**: ☐ 通过 ☐ 有问题需修复

**问题描述**:

---

---

---

---

**最后更新**: 2025-01-28
**版本**: MVP v2.0
